# CryptoLens

## 自托管架构, 已抛弃方案，请勿读取

```
┌───────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                   自托管服务器 (Self-Hosted Server | Debian 13 + Docker Engine)                                   │
│                                                                                                                                   │
│  ┌─────────────────────────────────────────────────┐      ┌────────────────────────────────────┐                                  │
│  │ Internet / 用户 (HTTPS:443, HTTP:80)            │      │  GitHub Actions (CI/CD)            │                                  │
│  └───────────────┬─────────────────────────────────┘      └──────────────┬───────────────────────┘                                  │
│                  ↓                                                       ↓ SSH                                                    │
├───────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                               Docker 容器环境 (由 Docker Compose 管理)                                              │
│                                                                                                                                   │
│  ┌─────────────────────────────────────────────────┐      ┌────────────────────────────────────┐                                  │
│  │ Nginx 容器 (Image: nginx:1.24)                  │      │ Certbot 容器 (Image: certbot/certbot)│                                  │
│  │ ├─职责: 反向代理, HTTPS终端, 静态文件服务       │<─────┤ ├─职责: 自动申请/续订SSL证书     │                                  │
│  └───────────────┬─────────────────────────────────┘      └────────────────────────────────────┘                                  │
│                  │                                                                                                                 │
│                  │ HTTP (通过 Docker 内部网络)                                                                                      │
│                  ↓                                                                                                                 │
│  ┌─────────────────────────────────────────────────┐                                                                               │
│  │ Golang API 网关容器                              │                                                                               │
│  │ ├─职责: 用户认证, API路由, 缓存, RBAC授权       │                                                                               │
│  │ └─技术栈: Gin, GORM, Go-Redis, JWT, Zap, Viper   ├───────────┐ REST/HTTP (Docker 内部网络)                                       │
│  └────────────────┬───────────────┬────────────────┘           │                                                                  │
│                   │               │                            ↓                                                                  │
│                   │               │              ┌──────────────────────────────────────────────────┐                                │
│                   │               │              │ Python 算法服务容器                               │                                │
│                   │               │              │ ├─职责: 指标计算, 数据处理, 异步任务              │                                │
│                   │               │              │ └─技术栈: FastAPI, Pandas, TA-Lib, SQLAlchemy    │                                │
│                   │               │              └─────────────────┬──────────────────┬──────────────┘                                │
│                   │               │                                │                  │                                             │
│                   │               └────────────────────────────────┼──────────────────┘                                             │
│                   │                TCP (Docker 内部网络)           │                                                                 │
│                   ↓                                                ↓                                                                 │
│  ┌─────────────────────────────────────────────────┐ ┌──────────────────────────────────────────────────┐                            │
│  │ PostgreSQL 容器 (Image: postgres:15)            │ │ Redis 容器 (Image: redis:7)                        │                            │
│  │ ├─职责: 主数据存储, 简单分析/搜索               │ │ ├─职责: 应用缓存, 轻量级消息队列 (Streams)         │                            │
│  └───────────────┬─────────────────────────────────┘ └────────────────┬─────────────────────────────────┘                            │
│                  │                                                    │                                                              │
├──────────────────┼────────────────────────────────────────────────────┼──────────────────────────────────────────────────────────┤
│                  ↓                                                    ↓                                                                │
│  ┌─────────────────────────────────────────────────┐ ┌──────────────────────────────────────────────────┐                           │
│  │ 宿主机持久化数据卷 (Host Persistent Volumes)     │ │ 宿主机文件目录 (Host Directory)                  │                           │
│  │ ├─存储: PostgreSQL 的数据库文件                 │ │ ├─存储: 用户上传的原始数据文件                   │                           │
│  │ └─路径示例: /var/lib/docker/volumes/pgdata/_data│ │ └─路径示例: /opt/cryptolens/files                │                           │
│  └─────────────────────────────────────────────────┘ └──────────────────────────────────────────────────┘                           │
│                                                                                                                                   │
└───────────────────────────────────────────────────────────────────────────────────────────────────┘
```

## 五层架构

``` 
┌─────────────────────────────────────────────────────────────────────────┐
│                             第一层：用户界面层                              │
│                         (User Interface Layer)                          │
├─────────────────────────────────────────────────────────────────────────┤
│                          React 18 + TypeScript                          │
│                                                                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │   交易界面    │ │   K线图表    │ │   资产面板    │ │   策略回测    │        │
│  │ Trading View│ │ ECharts/    │ │  Portfolio  │ │  Backtest   │        │
│  │             │ │ TradingView │ │             │ │             │        │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘        │
│                                                                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │   用户管理    │ │   系统设置    │ │   实时数据    │ │   历史数据    │        │
│  │ User Mgmt   │ │  Settings   │ │ Real-time  │ │  Historical │        │
│  │             │ │             │ │   Data     │ │    Data     │        │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘        │
│                                                                         │
│ 技术栈: React 18, TypeScript, Zustand, Tailwind CSS, shadcn/ui         │
│         React Router, React Hook Form, TanStack Query                  │
└─────────────────────────────────────────┬───────────────────────────────┘
                                          │ HTTPS/WebSocket API
                                          ▼

┌─────────────────────────────────────────────────────────────────────────┐
│                            第二层：API网关层                              │
│                         (API Gateway Layer)                            │
├─────────────────────────────────────────────────────────────────────────┤
│                         Golang Gin 框架                                │
│                                                                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │   用户认证    │ │   请求路由    │ │   限流熔断    │ │   数据验证    │        │
│  │  Auth/JWT   │ │  Routing    │ │ Rate Limit │ │ Validation  │        │
│  │   RBAC      │ │             │ │ & Circuit  │ │             │        │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘        │
│                                                                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │   日志记录    │ │   监控指标    │ │   API文档    │ │   压缩缓存    │        │
│  │  Logging    │ │  Metrics    │ │   Swagger   │ │ Compression │        │
│  │   Zap       │ │ Prometheus  │ │             │ │   & Cache   │        │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘        │
│                                                                         │
│ 技术栈: Gin, GORM, JWT, Zap, Viper, Go-Redis, Swagger                  │
└─────────────────────────────┬───────────────────────────────────────────┘
                              │
                              │ HTTP/gRPC
                              ▼

┌─────────────────────────────────────────────────────────────────────────┐
│                           第三层：业务服务层                              │
│                      (Business Service Layer)                          │
├─────────────────────────────────────────────────────────────────────────┤
│                    Golang 微服务集群                                    │
│                                                                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │   用户服务    │ │   资产服务    │ │   交易服务    │ │   订单服务    │        │
│  │  User Service│ │ Asset Service│ │ Trade Service│ │Order Service │        │
│  │ - 注册登录    │ │ - 资产查询    │ │ - 交易执行    │ │ - 订单管理    │        │
│  │ - 权限管理    │ │ - 资金管理    │ │ - 持仓管理    │ │ - 订单状态    │        │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘        │
│                                                                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │   风控服务    │ │   消息服务    │ │   通知服务    │ │   报表服务    │        │
│  │  Risk Service│ │ Message Serv│ │ Notification│ │ Report Serv │        │
│  │ - 风险控制    │ │ - 实时消息    │ │ - 邮件/SMS   │ │ - 数据报表    │        │
│  │ - 额度管理    │ │ - 事件推送    │ │ - 推送通知    │ │ - 统计分析    │        │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘        │
│                                                                         │
│ 技术栈: Golang, GORM, Redis, 微服务架构                                │
└─────────────────────────────┬───────────────────────────────────────────┘
                              │
                              │ HTTP/gRPC
                              ▼

┌─────────────────────────────────────────────────────────────────────────┐
│                           第四层：算法服务层                              │
│                      (Algorithm Service Layer)                         │
├─────────────────────────────────────────────────────────────────────────┤
│                    Python FastAPI 服务集群                              │
│                                                                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │  技术指标计算  │ │   策略回测    │ │   信号生成    │ │   风险评估    │        │
│  │  TA Analysis│ │ Backtesting │ │  Signals    │ │ Risk Assess │        │
│  │ - TA-Lib    │ │ - 历史回测    │ │ - 买卖信号    │ │ - 风险指标    │        │
│  │ - 技术指标    │ │ - 策略优化    │ │ - 预警提示    │ │ - 压力测试    │        │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘        │
│                                                                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │  数据预处理   │ │  机器学习模型  │ │  实时计算     │ │  批量计算     │        │
│  │ Preprocessing│ │ ML Models   │ │ Real-time   │ │ Batch Calc  │        │
│  │ - 数据清洗    │ │ - 预测模型    │ │ - 实时分析    │ │ - 离线计算    │        │
│  │ - 特征工程    │ │ - 模式识别    │ │ - 流处理      │ │ - 批量任务    │        │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘        │
│                                                                         │
│ 技术栈: FastAPI, Pandas, NumPy, TA-Lib, SciPy, scikit-learn           │
└─────────────────────────────┬───────────────────────────────────────────┘
                              │
                              │ 数据库查询/缓存访问
                              ▼

┌─────────────────────────────────────────────────────────────────────────┐
│                           第五层：数据存储层                              │
│                       (Data Storage Layer)                             │
├─────────────────────────────────────────────────────────────────────────┤
│                        数据持久化与缓存                                  │
│                                                                         │
│  ┌─────────────────┐              ┌─────────────────┐                   │
│  │   PostgreSQL    │              │     Redis       │                   │
│  │    主数据库       │              │      缓存        │                   │
│  ├─────────────────┤              ├─────────────────┤                   │
│  │  - 用户数据      │              │  - 会话缓存      │                   │
│  │  - 交易数据      │              │  - 热点数据      │                   │
│  │  - 资产数据      │              │  - 实时报价      │                   │
│  │  - 订单历史      │              │  - 消息队列      │                   │
│  │  - K线数据      │              │                 │                   │
│  └─────────────────┘              └─────────────────┘                   │
│                                                                         │
│  ┌─────────────────┐              ┌─────────────────┐                   │
│  │   文件存储系统    │              │   监控数据存储    │                   │
│  │  File Storage   │              │   Monitoring   │                   │
│  ├─────────────────┤              ├─────────────────┤                   │
│  │  - 日志文件      │              │  - Prometheus  │                   │
│  │  - 配置文件      │              │  - 指标数据      │                   │
│  │  - 备份数据      │              │  - 性能数据      │                   │
│  └─────────────────┘              └─────────────────┘                   │
│                                                                         │
│ 技术栈: PostgreSQL, Redis, 本地文件系统, Prometheus                    │
└─────────────────────────────────────────────────────────────────────────┘

                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                       基础设施支撑层（横跨所有层）                          │
│                   (Infrastructure Support Layer)                       │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │   Docker    │ │   监控告警    │ │   CI/CD     │ │   Nginx     │        │
│  │  Container  │ │ Monitoring  │ │  Pipeline   │ │  Reverse    │        │
│  │             │ │ & Alert     │ │             │ │   Proxy     │        │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘        │
│                                                                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐        │
│  │   集群管理    │ │   日志收集    │ │  证书管理    │ │  备份恢复    │        │
│  │  Kubernetes │ │ Logging     │ │  SSL Cert   │ │  Backup &   │        │
│  │             │ │   ELK       │ │  Management │ │  Recovery   │        │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘        │
│                                                                         │
│ 技术栈: Docker, Kubernetes, Nginx, Prometheus, Grafana, GitHub Actions │
└─────────────────────────────────────────────────────────────────────────┘
```


---

## 前端技术栈
``` 
┌─────────────────────────────────────────────────────────────┐
│                        React 前端层                          │
├─────────────────────────────────────────────────────────────┤
│ 框架:       React 18 + TypeScript                           │
│ 状态管理:    Zustand (轻量级状态管理)                       │
│ UI组件:     shadcn/ui + Radix UI (原生组件)                │
│ 样式方案:   Tailwind CSS + CSS Modules                     │
│ 图表库:     ECharts 5.x + TradingView Lightweight Charts   │
│ 构建工具:   Vite 4.x                                       │
│ 路由:       React Router 6.x                               │
│ 表单处理:   React Hook Form + Zod (验证)                   │
│ 数据获取:   TanStack Query (原React Query)                │
│ 工具库:     date-fns, lodash-es, axios                     │
│ 测试:       Vitest + React Testing Library                 │
│ 代码质量:   ESLint + Prettier + TypeScript Strict         │
└─────────────────────────────────────────────────────────────┘
```

## 后端技术栈

``` 
┌─────────────────────────────────────────────────────────────┐
│                     Golang API 网关层                        │
├─────────────────────────────────────────────────────────────┤
│ Web框架:    Gin 1.9.x                                      │
│ 数据库ORM:  GORM 2.0.x                                     │
│ 缓存:       Go-Redis v9                                    │
│ 配置管理:   Viper                                          │
│ 认证授权:   JWT + 简易RBAC中间件                             │
│ 日志:       Zap + Lumberjack                               │
│ 验证器:     validator.v10                                  │
│ 文档:       Swagger (swaggo)                               │
│ 测试:       testify + golang-mock                          │
│ 监控:       Prometheus + Grafana                           │
│ 容器:       Docker 24.x                                    │
└─────────────────────────────────────────────────────────────┘
```

## 算法服务技术栈

``` 
┌─────────────────────────────────────────────────────────────┐
│                    Python 算法服务层                         │
├─────────────────────────────────────────────────────────────┘
│ Web框架:    FastAPI 0.104.x                                │
│ 数据处理:   Pandas 2.x + NumPy 1.25.x                      │
│ 技术指标:   TA-Lib 0.4.x + tulipy (备用)                   │
│ 异步任务:   FastAPI BackgroundTasks                          │
│ 数据验证:   Pydantic 2.x                                   │
│ 数据库:     SQLAlchemy 2.0.x + asyncpg                     │
│ 数学计算:   SciPy + scikit-learn (机器学习备用)            │
│ 测试:       pytest + hypothesis                            │
│ 文档:       FastAPI AutoDocs + Redoc                       │
│ 性能分析:   py-spy + memory-profiler                       │
│ 容器:       Docker 24.x                                    │
└─────────────────────────────────────────────────────────────┘
```

## 数据存储技术栈

``` 
┌─────────────────────────────────────────────────────────────┐
│                        数据存储层                            │
├─────────────────────────────────────────────────────────────┤
│ 主数据库:   PostgreSQL 15.x                                  │
│ 缓存:       Redis 7.x                                       │
│ 文件存储:   本地文件系统(考虑云存储)                            │
│ 消息队列:   Redis Streams                                   │
└─────────────────────────────────────────────────────────────┘
```

## 基础设施与运维

``` 
┌─────────────────────────────────────────────────────────────┐
│                    基础设施与运维层                            │
├─────────────────────────────────────────────────────────────┤
│ 容器化:     Docker 24.x + Docker Compose                     │
│ 监控:       Prometheus + Grafana                             │
│ CI/CD:      GitHub Actions                                 │
│ 反向代理:   Nginx 1.24.x                                    │
| 证书管理: Let's Encrypt + Certbot                             |
└─────────────────────────────────────────────────────────────┘
```